{% load static %}

<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mapa</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }

    body {
      background: url("{% static 'mapa_gibralta.jpg' %}") center/cover no-repeat;
    }

    /* Botões de Ação (Inventário e Fechar) */
    .btn-acao {
      position: fixed;
      top: 10px;
      color: white;
      padding: 10px 18px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 20;
      transition: opacity 0.3s ease, background 0.2s, right 0.4s ease; /* Adicionado transição para 'right' */
    }

    .btn-acao:hover {
      background: rgba(255,255,255,0.2);
    }
    
    #btnInventario {
        right: 10px;
        background: rgba(0,0,0,0.7);
    }
    
    #btnCloseInventario {
        font-size: 24px;
        line-height: 1;
        padding: 8px 16px;
        background: rgba(255,255,255,0.2);
        right: 10px;
        z-index: 40; 
        display: none;
    }

    /* Painel do inventário */
    #painelInventario {
      position: fixed;
      top: 0;
      right: -350px;
      width: 300px;
      height: 100%;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 20px;
      transition: right 0.4s ease;
      z-index: 30;
      overflow-y: auto;
      
      display: flex; 
      flex-direction: column;
      align-items: center;
    }

    #painelInventario.aberto {
      right: 0;
    }

    .btn-fechar-aberto {

        right: 0px !important;
        background: crimson;
        border-radius: 8px 0 0 8px !important;
    }

    .item {
      background: rgba(255,255,255,0.1);
      margin-bottom: 15px; 
      padding: 5px; 
      border-radius: 6px;
      width: 90%; 
      max-width: 250px; 
      height: 180px; 
    }

    /* Pontos no mapa */
    .ponto {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid white;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }

    .nao-explorado { background: crimson; }
    .explorado { background: green; }
    
    .counter-btn {
    width: 40px; /* Aumentei um pouco para caber números maiores */
    height: 40px;
    border-radius: 50%;
    border: 2px solid white; /* Um contorno branco ajuda no destaque */
    background: #e4a701ff;
    color: white;
    font-weight: bold;
    cursor: pointer;
    /* Alinhamento perfeito do texto */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.1s;
    outline: none;
  
}
.btn-menos {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    border: 1px solid white;
    background: crimson;
    color: white;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 5px; /* Espaço entre o laranja e o vermelho */
    transition: transform 0.1s;
}
.btn-menos:hover { background: darkred; }
  </style>
</head>

<body>

  <button id="btnInventario" class="btn-acao">Inventário</button>
  
  <button id="btnCloseInventario" class="btn-acao">X</button>

  <div id="counterButtons">
    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 150px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">metal</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>

    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 250px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">madeira</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>

    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 350px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">vidro</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>

    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 450px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">polvóra</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>

    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 550px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">tecido</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>

    <div class="counter-btn-container" style="position: absolute; top: 580px; left: 650px; display: flex; flex-direction: column; align-items: center;">
        <span style="color: white; font-family: sans-serif; font-size: 12px; margin-bottom: 5px;">livro</span>
        <div style="display: flex; align-items: center;">
            <button class="counter-btn">0</button>
            <button class="btn-menos">-</button>
        </div>
    </div>
</div>

  <div id="painelInventario">
    <h2>Inventário</h2>

    {% for item_inv in inventario %}
      <div class="item" style="height: 150px; text-align: center; padding: 0;">
        <div style="
          width: 100%; 
          height: 100%; 
          border-radius: 6px; 
          background-image: url('{% static item_inv.item.caminho %}'); 
          background-size: contain; 
          background-repeat: no-repeat; 
          background-position: center;
          margin-bottom: 5px;
        ">
        </div>
      </div>
    {% empty %}
      <p>Seu inventário está vazio.</p>
    {% endfor %}
  </div>

  <form method="POST" style="position:absolute; top:12%; left:50%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="1">
    <button type="submit"
      class="ponto {% if 1 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>
    
  <form method="POST" style="position:absolute; top:20%; left:90%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="2">
    <button type="submit"
      class="ponto {% if 2 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:40%; left:20%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="3">
    <button type="submit"
      class="ponto {% if 3 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:50%; left:87%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="4">
    <button type="submit"
      class="ponto {% if 4 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:65%; left:45%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="5">
    <button type="submit"
      class="ponto {% if 5 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:70%; left:15%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="6">
    <button type="submit"
      class="ponto {% if 6 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:80%; left:30%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="7">
    <button type="submit"
      class="ponto {% if 7 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:35%; left:85%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="8">
    <button type="submit"
      class="ponto {% if 8 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:30%; left:60%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="9">
    <button type="submit"
      class="ponto {% if 9 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  <form method="POST" style="position:absolute; top:80%; left:87%;">
    {% csrf_token %}
    <input type="hidden" name="id_do_local" value="10">
    <button type="submit"
      class="ponto {% if 10 in explorados %}explorado{% else %}nao-explorado{% endif %}">
    </button>
  </form>

  
  <script>
      const btnInventario = document.getElementById("btnInventario");
      const btnCloseInventario = document.getElementById("btnCloseInventario");
      const painel = document.getElementById("painelInventario");

      // --- LÓGICA DOS CONTADORES ---

      // 1. Botão Laranja (Aumentar)
      const botoesAumentar = document.querySelectorAll('.counter-btn');
      botoesAumentar.forEach(btn => {
          btn.addEventListener('click', function() {
              let valorAtual = parseInt(this.innerText) || 0;
              this.innerText = valorAtual + 1;
              
              // Efeito visual de clique
              this.style.transform = "scale(0.9)";
              setTimeout(() => { this.style.transform = "scale(1)"; }, 100);
          });
      });

      // 2. Botão Vermelho (Diminuir)
      const botoesDiminuir = document.querySelectorAll('.btn-menos');
      botoesDiminuir.forEach(btn => {
          btn.addEventListener('click', function() {
              // Encontra o botão laranja que está no mesmo container que este botão vermelho
              const btnLaranja = this.parentElement.querySelector('.counter-btn');
              let valorAtual = parseInt(btnLaranja.innerText) || 0;
              
              // Diminui apenas se for maior que zero (para não ficar negativo)
              if (valorAtual > 0) {
                  btnLaranja.innerText = valorAtual - 1;
              }

              // Efeito visual de clique
              this.style.transform = "scale(0.8)";
              setTimeout(() => { this.style.transform = "scale(1)"; }, 100);
          });
      });


      // --- LÓGICA DO INVENTÁRIO ---

      function toggleInventario() {
          painel.classList.toggle("aberto");
          const isAberto = painel.classList.contains("aberto");

          if (isAberto) {
              btnInventario.style.display = 'none';
              btnCloseInventario.style.display = 'block';
              btnCloseInventario.classList.add('btn-fechar-aberto');
          } else {
              btnInventario.style.display = 'block';
              btnCloseInventario.style.display = 'none';
              btnCloseInventario.classList.remove('btn-fechar-aberto');
          }
      }

      btnInventario.addEventListener("click", toggleInventario);
      btnCloseInventario.addEventListener("click", toggleInventario);
  </script>

</body>
</html>